(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{2:function(e,t){e.exports={USER_CONNECTED:"USER_CONNECTED",USER_DISCONNECTED:"USER_DISCONNECTED",GAME_UPDATE:"GAME_UPDATE",VERIFY_USER:"VERIFY_USER",LOGOUT:"LOGOUT",USER_READY:"USER_READY",GAME_START:"GAME_START",GAME_INIT:"GAME_INIT",READY:"READY",USER_IN_GAME:"USER_IN_GAME",GAME_REQUEST:"GAME_REQUEST",REQUEST_DENIED:"REQUEST_DENIED",RESET:"RESET",ADD_SHAPES:"ADD_SHAPES",SEND_TO_SPECTATOR:"SEND_TO_SPECTATOR",SPECTATE:"SPECTATE",SPECTATE_INFO:"SPECTATE_INFO",DISPLAY_GAMES:"DISPLAY_GAMES",INITIALIZE_GAME:"INITIALIZE_GAME",GAME_OVER:"GAME_OVER",GAME_SETUP:"GAME_SETUP",HIGHSCORE:"HIGHSCORE",WINNER:"WINNER",REGISTER:"REGISTER",LIST_UPDATE:"LIST_UPDATE",MULTIPLAYER:"MULTIPLAYER"}},37:function(e,t){e.exports={createEmptyMatrix:function(e,t){var a=[];function r(){for(var t=[],a=0;a<e;a++)t.push({status:!1,color:"white"});return t}for(var n=0;n<t;n++)a.push(r());return a.push(function(){for(var t=[],a=0;a<e;a++)t.push({status:!0,color:"black"});return t}()),a},isGameOver:function(e,t){return!e.areBlocksFreeToMoveDown(t)},isRowComplete:function(e,t,a){for(var r=[],n=function(t){var n=0;a[t].forEach(function(e){e.status&&n++}),n===e&&r.push(t)},s=0;s<t;s++)n(s);return r},createGrid:function(e,t,a,r,n){n&&(r/=2),e.lineWidth=1,e.strokeStyle="#ccc";for(var s=1;s<a;s++)e.beginPath(),e.moveTo(0,s*r),e.lineTo(t*r,s*r),e.stroke();for(var o=1;o<t;o++)e.beginPath(),e.moveTo(o*r,0),e.lineTo(o*r,a*r),e.stroke()}}},38:function(e,t,a){var r=a(79),n={0:[[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:-1,y:1}],[{x:0,y:0},{x:0,y:-1},{x:1,y:0},{x:1,y:1}]],1:[[{x:0,y:0},{x:-1,y:0},{x:0,y:1},{x:1,y:1}],[{x:0,y:0},{x:0,y:1},{x:1,y:0},{x:1,y:-1}]],2:[[{x:0,y:0},{x:-1,y:0},{x:0,y:1},{x:1,y:0}],[{x:0,y:0},{x:0,y:1},{x:1,y:0},{x:0,y:-1}],[{x:0,y:0},{x:1,y:0},{x:0,y:-1},{x:-1,y:0}],[{x:0,y:0},{x:0,y:-1},{x:-1,y:0},{x:0,y:1}]],3:[[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:2,y:0}],[{x:0,y:0},{x:0,y:-1},{x:0,y:-2},{x:0,y:1}]],4:[[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:-1,y:1}],[{x:0,y:0},{x:0,y:-1},{x:0,y:1},{x:1,y:1}],[{x:0,y:0},{x:-1,y:0},{x:1,y:0},{x:1,y:-1}],[{x:0,y:0},{x:0,y:1},{x:0,y:-1},{x:-1,y:-1}]],5:[[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:1,y:1}],[{x:0,y:0},{x:0,y:-1},{x:0,y:1},{x:1,y:-1}],[{x:0,y:0},{x:-1,y:0},{x:1,y:0},{x:-1,y:-1}],[{x:0,y:0},{x:0,y:1},{x:0,y:-1},{x:-1,y:1}]],6:[[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}]],7:[[{x:0,y:0}]],8:[[{x:0,y:0},{x:1,y:0}],[{x:0,y:0},{x:0,y:1}]],9:[[{x:0,y:0},{x:1,y:0},{x:-1,y:0}],[{x:0,y:0},{x:0,y:-1},{x:0,y:1}]]},s={0:"OrangeRed",1:"blue",2:"yellow",3:"orange",4:"GreenYellow",5:"Aqua",6:"DeepPink",7:"dodgerblue",8:"red",9:"green"};e.exports={createUser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,a=void 0===t?"":t,n=e.socketID,s=void 0===n?null:n,o=e.inGame,i=void 0!==o&&o,c=e.isReady,l=void 0!==c&&c,u=e.score,h=void 0===u?0:u,d=e.gameMode,m=void 0===d?0:d,v=e.gameName,f=void 0===v?"":v;return{id:r(),name:a,socketID:s,inGame:i,isReady:l,score:h,gameMode:m,gameName:f}},createGameData:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).matrix;return{matrix:void 0===e?[]:e}},generateShapes:function(e,t){for(var a=Math.floor(Math.random()*Math.floor(t)),r=[],o=0;o<e;o++)a=Math.floor(Math.random()*Math.floor(t)),r.push({coords:n[a],color:s[a]});return r}}},41:function(e,t,a){e.exports=a(83)},46:function(e,t,a){},47:function(e,t,a){},48:function(e,t,a){},75:function(e,t){},83:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),s=a(39),o=a.n(s),i=(a(46),a(47),a(3)),c=a(4),l=a(6),u=a(5),h=a(7),d=(a(48),a(40)),m=a.n(d),v=a(2),f=function(){function e(t,a,r,n){Object(i.a)(this,e),this.left=void 0,this.top=void 0,this.color=void 0,this.size=void 0,this.left=t,this.top=a,this.color=r,this.size=n}return Object(c.a)(e,[{key:"setTop",value:function(e){this.top=e}},{key:"updateCanvas",value:function(e,t){e.fillStyle=this.color,t&&(e.fillStyle=t),e.strokeStyle="black",e.lineWidth=2,e.beginPath(),e.fillRect(this.left,this.top,this.size,this.size),e.rect(this.left,this.top,this.size,this.size),e.stroke()}},{key:"draw",value:function(e,t,a,r){a.beginPath(),a.fillStyle=r,a.strokeStyle="black",a.lineWidth=2,a.fillRect(e,t,this.size,this.size),a.rect(e,t,this.size,this.size),a.stroke()}},{key:"moveDown",value:function(){this.top+=this.size}},{key:"moveBack",value:function(){this.top-=this.size}},{key:"moveLeft",value:function(){this.left-=this.size}},{key:"moveRight",value:function(){this.left+=this.size}},{key:"isBlockFreeToMoveLeft",value:function(e){return!e[Math.abs(this.top/this.size)][Math.abs(this.left/this.size-1)].status}},{key:"isBlockFreeToMoveRight",value:function(e){var t=!1;return null!=e[Math.abs(this.top/this.size)][Math.abs(this.left/this.size+1)]&&(e[Math.abs(this.top/this.size)][Math.abs(this.left/this.size+1)].status||(t=!0)),t}},{key:"isBlockFreeToMoveDown",value:function(e){return!e[Math.abs(this.top/this.size)][this.left/this.size].status}},{key:"isBlockFreeToRotate",value:function(e){return!e[Math.abs(this.top/this.size)][Math.abs(this.left/this.size)].status}}]),e}(),p=function(){function e(t,a,r,n,s){var o=this;Object(i.a)(this,e),this.coordiantesArr=void 0,this.blocksArr=void 0,this.top=void 0,this.left=void 0,this.columns=void 0,this.rows=void 0,this.size=void 0,this.currentPosition=void 0,this.color=void 0,this.setBlocks=function(e){o.blocksArr=e},this.coordiantesArr=t,this.top=0,this.left=0,this.rows=r,this.columns=a,this.size=n,this.currentPosition=0,this.color=s,this.blocksArr=this.fillArr(t[0],n,a)}return Object(c.a)(e,[{key:"fitToSide",value:function(e){var t=this;this.blocksArr=this.blocksArr.map(function(a){return new f(a.left-e*t.size,a.top,t.color,t.size)})}},{key:"defineNewProperties",value:function(e,t,a){var r=this;this.blocksArr=e.map(function(e){return new f(Math.floor(e.left/t*a),Math.floor(e.top/t*a),"red",r.size)})}},{key:"fillArr",value:function(e,t,a){var r=this,n=[];return e.forEach(function(e){n.push(new f((e.x+Math.floor(a/2)-1)*t,e.y*t,r.color,t))}),n}},{key:"moveDown",value:function(){this.blocksArr.forEach(function(e){e.moveDown()}),this.top+=1}},{key:"moveRight",value:function(){this.areBlockOutOfBoundsRight()&&(this.blocksArr.forEach(function(e){e.moveRight()}),this.left+=1)}},{key:"moveLeft",value:function(){this.areBlockOutOfBoundsLeft()&&(this.blocksArr.forEach(function(e){e.moveLeft()}),this.left-=1)}},{key:"moveBack",value:function(){this.blocksArr.forEach(function(e){e.moveBack()})}},{key:"updateCanvas",value:function(e){var t=this;this.blocksArr.forEach(function(a){a.updateCanvas(e,t.color)})}},{key:"areBlocksFreeToMoveLeft",value:function(e){var t=!0;return this.blocksArr.forEach(function(a){a.isBlockFreeToMoveLeft(e)||(t=!1)}),t}},{key:"areBlocksFreeToMoveRight",value:function(e){var t=!0;return this.blocksArr.forEach(function(a){a.isBlockFreeToMoveRight(e)||(t=!1)}),t}},{key:"areBlocksFreeToMoveDown",value:function(e){var t=!0;return this.blocksArr.forEach(function(a){a.isBlockFreeToMoveDown(e)||(t=!1)}),t}},{key:"areBlocksFreeToMoveDownNumber",value:function(e){var t=0;return this.blocksArr.forEach(function(a){a.isBlockFreeToMoveDown(e)||(t+=1)}),t>0&&(this.blocksArr[0].left==this.blocksArr[3].left&&this.blocksArr[0].left==this.blocksArr[1].left&&this.blocksArr[0].left==this.blocksArr[2].left||this.blocksArr[0].top==this.blocksArr[3].top&&this.blocksArr[0].top==this.blocksArr[1].top&&this.blocksArr[0].top==this.blocksArr[2].top||(this.blocksArr[0].left==this.blocksArr[3].left&&this.blocksArr[0].left==this.blocksArr[1].left&&this.blocksArr[0].top==this.blocksArr[2].top?t*=2:this.blocksArr[0].top==this.blocksArr[3].top&&this.blocksArr[0].top==this.blocksArr[1].top&&this.blocksArr[0].left==this.blocksArr[2].left?t+=1:this.blocksArr[0].top==this.blocksArr[2].top&&this.blocksArr[0].top==this.blocksArr[1].top&&this.blocksArr[2].left==this.blocksArr[3].left?t+=1:this.blocksArr[0].left==this.blocksArr[2].left&&this.blocksArr[0].left==this.blocksArr[1].left&&this.blocksArr[2].top==this.blocksArr[3].top?t*=2:this.blocksArr[0].left==this.blocksArr[2].left&&this.blocksArr[0].left==this.blocksArr[1].left&&this.blocksArr[1].top==this.blocksArr[3].top?t*=2:this.blocksArr[0].top==this.blocksArr[2].top&&this.blocksArr[0].top==this.blocksArr[1].top&&this.blocksArr[1].left==this.blocksArr[3].left?t+=1:this.blocksArr[0].left==this.blocksArr[2].left&&this.blocksArr[1].left==this.blocksArr[3].left&&this.blocksArr[0].top==this.blocksArr[1].top?t*=2:this.blocksArr[0].top==this.blocksArr[2].top&&this.blocksArr[1].top==this.blocksArr[3].top&&this.blocksArr[0].left==this.blocksArr[1].left?t+=1:this.blocksArr[0].left==this.blocksArr[1].left&&this.blocksArr[2].left==this.blocksArr[3].left&&this.blocksArr[0].top==this.blocksArr[2].top?t*=2:this.blocksArr[0].top==this.blocksArr[1].top&&this.blocksArr[2].top==this.blocksArr[3].top&&this.blocksArr[0].left==this.blocksArr[2].left&&(t+=1))),t}},{key:"rotate",value:function(){var e=this.currentPosition,t=this.coordiantesArr;e<t.length-1?(e+=1,this.blocksArr=this.fillArr(this.moveAdjustment(t[e]),this.size,this.columns),this.currentPosition=e):(e=0,this.blocksArr=this.fillArr(this.moveAdjustment(t[e]),this.size,this.columns),this.currentPosition=e)}},{key:"moveAdjustment",value:function(e){var t=this,a=[];return e.forEach(function(e){a.push({x:e.x+t.left,y:e.y+t.top})}),a}},{key:"areBlocksFreeToRotate",value:function(e){var t=!0;return this.blocksArr.forEach(function(a){a.isBlockFreeToRotate(e)||(t=!1)}),t}},{key:"areBlockOutOfBoundsLeft",value:function(){var e=!0;return this.blocksArr.forEach(function(t){t.left<=0&&(e=!1)}),e}},{key:"areBlockOutOfRotateBoundsLeft",value:function(){var e=!0;return this.blocksArr.forEach(function(t){t.left<0&&(e=!1)}),e}},{key:"areBlockOutOfBoundsRight",value:function(){var e=this,t=!0;return this.blocksArr.forEach(function(a){a.left>=(e.columns-1)*e.size&&(t=!1)}),t}},{key:"areBlockOutOfRotateBoundsRight",value:function(){var e=this,t=!0;return this.blocksArr.forEach(function(a){a.left>(e.columns-1)*e.size&&(t=!1)}),t}}]),e}(),S=new function e(){var t=this;Object(i.a)(this,e),this.socket=m()("http://localhost:3231"),this.initSocket=function(){return t.socket.on("connect",function(){}),t.socket},this.generateShapes=function(e,a,r){return t.socket.on(v.GAME_INIT,function(t){var n=t.map(function(t){return new p(t.coords,e,a,r,t.color)});t=n}),[]},this.initMainTetrisContext=function(e,a,r,n,s,o,i,c,l,u,h,d){t.socket.on(v.USER_READY,function(e){e.tf&&(a(e.user),n(e.user,!0))}),t.socket.on(v.WINNER,function(e){d(e)}),t.socket.on(v.USER_DISCONNECTED,function(e){c(e.name)}),t.socket.on(v.REQUEST_DENIED,function(e){n(e,!1)}),t.socket.on(v.RESET,function(e){o(e),c(e)}),t.socket.on(v.ADD_SHAPES,function(e){r(e)}),t.socket.on(v.INITIALIZE_GAME,function(t){e(t.generatedShapes),l(t.generatedShapes),s(t.recievers),h(t.difficulty),u(!0)}),t.socket.on(v.GAME_OVER,function(e){i(e)})},this.updateGame=function(e){t.socket.on(v.GAME_UPDATE,function(t){e(t)})},this.spectatingGames=function(e){t.socket.on(v.SEND_TO_SPECTATOR,function(t){e(t)})},this.initMenu=function(e){t.socket.on(v.HIGHSCORE,function(t){e(t)})},this.initUserContainer=function(e,a,r,n,s,o,i,c,l,u,h,d,m,f){t.socket.on(v.RESET,function(e){m(e),f(e)}),t.socket.on(v.USER_CONNECTED,function(t){e(t)}),t.socket.on(v.USER_DISCONNECTED,function(t){e(t.allUsers)}),t.socket.on(v.INITIALIZE_GAME,function(e){s(!1),l(!1)}),t.socket.on(v.GAME_REQUEST,function(e){var t=e.sender;a(t)}),t.socket.on(v.GAME_START,function(e){e.start&&(r(),n())}),t.socket.on(v.SPECTATE,function(e){i(e)}),t.socket.on(v.SPECTATE_INFO,function(e){o(e)}),t.socket.on(v.DISPLAY_GAMES,function(e){c(e)}),t.socket.on(v.GAME_SETUP,function(e){u(e)}),t.socket.on(v.USER_READY,function(e){e.tf?h():d()})},this.initRegister=function(e,a){t.socket.on(v.REGISTER,function(t){t?a({target:{value:3}}):e("User already exists!")})},this.emitGameUpdate=function(e,a,r,n,s,o,i,c){t.socket.emit(v.GAME_UPDATE,{matrix:e,shape:a,reciever:r,sender:n,totalScore:s,score:o,acceleration:i,blockSize:c})},this.emitUserInGame=function(e){t.socket.emit(v.USER_IN_GAME,{username:e})},this.emitLogout=function(){t.socket.emit(v.LOGOUT)},this.emitUserConnected=function(e){t.socket.emit(v.USER_CONNECTED,e)},this.emitUserReady=function(e,a){t.socket.emit(v.USER_READY,{user:e,reqSender:a})},this.emitGameRequest=function(e,a){t.socket.emit(v.GAME_REQUEST,{sender:e,reciever:a})},this.emitGameStart=function(e,a){t.socket.emit(v.GAME_START,{to:e,user:a})},this.emitVerifyUser=function(e,a,r){t.socket.emit(v.VERIFY_USER,e,a,r)},this.emitReset=function(e,a,r){t.socket.emit(v.RESET,{to:e,user:a,keepGameMode:r})},this.emitAddShapes=function(e){t.socket.emit(v.ADD_SHAPES,e)},this.emitSpectate=function(e,a){t.socket.emit(v.SPECTATE,{user:e,game:a})},this.emitSpectatorData=function(e,a,r,n,s,o,i){t.socket.emit(v.SEND_TO_SPECTATOR,{matrix:e,shape:a,spectator:r,user:n,totalScore:s,score:o,blockSize:i})},this.emitInitializeGame=function(e,a,r){t.socket.emit(v.INITIALIZE_GAME,{sender:e,recievers:a,difficulty:r})},this.emitRequestDenied=function(e,a){t.socket.emit(v.REQUEST_DENIED,{user:e,reqSender:a})},this.emitGameOver=function(e,a,r,n,s){t.socket.emit(v.GAME_OVER,{user:e,recievers:a,score:r,totalScore:n,difficulty:s})},this.emitGameSetup=function(e,a){t.socket.emit(v.GAME_SETUP,{master:e,recievers:a})},this.emitRegister=function(e,a){t.socket.emit(v.REGISTER,{name:e,password:a})},this.emitListUpdate=function(){t.socket.emit(v.LIST_UPDATE)},this.emitMultiplayer=function(e){t.socket.emit(v.MULTIPLAYER,e)}},k=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).componentDidMount=function(){S.initRegister(a.setError,a.props.setDisplay)},a.register=function(e){e.preventDefault();var t=a.state,r=t.name,n=t.password;n.length>5?(S.emitRegister(r,n),a.setError("")):a.setError("Password must contain at least 6 characters!")},a.changeName=function(e){e.preventDefault(),a.setState({name:e.target.value})},a.changePass=function(e){e.preventDefault(),a.setState({password:e.target.value})},a.setError=function(e){a.setState({error:e})},a.render=function(){var e=a.state.error,t=a.props.setDisplay;return n.a.createElement("div",{className:"loginForm"},n.a.createElement("div",{className:"loginFormTitle"},"Registration"),n.a.createElement("div",{className:"error"},e||null),n.a.createElement("form",{onSubmit:a.register},n.a.createElement("div",{className:"loginFormText"},"Enter username:"),n.a.createElement("input",{onChange:a.changeName,type:"text",placeholder:"username..."}),n.a.createElement("div",{className:"loginFormText"},"Enter password:"),n.a.createElement("input",{onChange:a.changePass,type:"password",placeholder:"password..."}),n.a.createElement("input",{type:"submit",value:"Submit"})),n.a.createElement("div",null,n.a.createElement("button",{value:0,onClick:t},"Back"),n.a.createElement("button",{value:1,onClick:t},"Login")))},a.state={name:"",password:"",error:""},a}return Object(h.a)(t,e),t}(n.a.Component),E=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).textInput=void 0,a.setError=function(e){a.setState({error:e})},a.setUser=function(e){var t=e.user,r=e.isUser;0==r?a.setError("User is already logged in!"):1==r?a.setError("Incorrect username or password!"):2==r&&(a.props.setUser(t),a.setError(""))},a.handleChange=function(e){var t=e.target.value;a.setState({nickname:t})},a.handlePassword=function(e){var t=e.target.value;a.setState({password:t})},a.handleSubmit=function(e){e.preventDefault();var t=a.state,r=t.nickname,n=t.password;S.emitVerifyUser(r,n,a.setUser)},a.state={nickname:"",error:"",password:""},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.state,a=t.nickname,r=t.error,s=this.props.setDisplay;return n.a.createElement("div",{className:"loginForm"},n.a.createElement("div",{className:"loginFormTitle"},"Login"),n.a.createElement("form",{onSubmit:this.handleSubmit},n.a.createElement("div",{className:"error"},r||null),n.a.createElement("div",{className:"loginFormText"},"Username:"),n.a.createElement("input",{ref:function(t){e.textInput=t},type:"text",id:"nickname",value:a,onChange:this.handleChange,maxLength:16,placeholder:"username",autoComplete:"off"}),n.a.createElement("div",{className:"loginFormText"},"Password:"),n.a.createElement("input",{type:"password",id:"password",onChange:this.handlePassword,maxLength:16,placeholder:"password"}),n.a.createElement("input",{type:"submit",onClick:this.handleSubmit,value:"Login"})),n.a.createElement("div",null,n.a.createElement("button",{value:0,onClick:s},"Back"),n.a.createElement("button",{value:2,onClick:s},"Register")))}}]),t}(n.a.Component),y=a(8),b=a(21),g=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).accept=function(e){1==e.target.value?a.props.accept(!0):0==e.target.value&&a.props.accept(!1)},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return n.a.createElement("div",{className:"request"},n.a.createElement("p",null,this.props.name," wants to play a game."),n.a.createElement("div",null,n.a.createElement("button",{onClick:this.accept,value:1},"Accept"),n.a.createElement("button",{onClick:this.accept,value:0},"Decline")))}}]),t}(n.a.Component),w=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).createStringFromArray=function(e,t){return e.forEach(function(e){t+=t?", "+e:e}),t},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.recievers,a=e.initializeGame,r=e.showInitBtn,s=e.invitedPlayers,o=e.isPlayer,i=e.gameMaster;return n.a.createElement("div",{className:"gameSetup"},n.a.createElement("p",null,"Game Setup"),s.length>0?n.a.createElement("div",null,n.a.createElement("table",{className:"tableLeft"},n.a.createElement("tbody",null,n.a.createElement("tr",null,n.a.createElement("td",{className:"tdNarrow"},"Player 1"),n.a.createElement("td",{className:"tdWide",id:"leftAlign"},i||" ")),n.a.createElement("tr",null,n.a.createElement("td",{className:"tdNarrow"},"Player 3"),n.a.createElement("td",{className:"tdWide",id:"leftAlign"},s[1]?s[1]:"  ")))),n.a.createElement("table",{className:"tableRight"},n.a.createElement("tbody",null,n.a.createElement("tr",null,n.a.createElement("td",{className:"tdWide",id:"rightAlign"},s[0]?s[0]:"  "),n.a.createElement("td",{className:"tdNarrow"},"Player 2")),n.a.createElement("tr",null,n.a.createElement("td",{className:"tdWide",id:"rightAlign"},s[2]?s[2]:"  "),n.a.createElement("td",{className:"tdNarrow"},"Player 4"))))):n.a.createElement("p",null,"Select players from left sidebar and then invite them or wait for an invite to enter a multiplayer game"),t.length>0&&r?n.a.createElement("button",{className:"roundBtn",onClick:a},"Initialize Game"):null,o?n.a.createElement("div",{className:"roundDiv"},n.a.createElement("div",{className:"innerRound"},"Waiting for other players...")):null)}}]),t}(n.a.Component),A=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).updateGameSetupScreen=function(e){a.setState({invitedPlayers:e.recievers,gameMaster:e.master})},a.removeGameMaster=function(e){e==a.state.gameMaster&&(a.reset(),S.emitReset([],a.props.user,!0))},a.finalizeStart=function(){a.props.startGame(),a.setState({showStartBtn:!1})},a.setSender=function(e){a.setState({sender:e,reqSent:!0})},a.setRequest=function(){a.setState({reqSent:!0,showReq:!1})},a.setSide=function(e){a.setState({showSide:e})},a.showRequest=function(e){a.setState({showReq:e,reqSent:!1})},a.accept=function(e){var t=a.props,r=t.user,n=t.isSpectator,s=t.reciever,o=t.changeSpectatingStatus,i=t.setRecievers,c=a.state.sender;a.setState({showReq:!1}),e?(n&&(S.emitReset(s,r,!1),o(!1),i([]),a.setInitBtn(!0)),S.emitUserReady(r,c),a.setState({isGameMaster:!1,isPlayer:!0})):(S.emitRequestDenied(r,c),n||a.reset())},a.emitGameSetup=function(){var e=a.props,t=e.user,r=e.reciever;a.setState({invitedPlayers:r}),S.emitGameSetup(t,r)},a.removeInvitedPlayer=function(e){var t=a.state.invitedPlayers,r=t.indexOf(e);-1!=r&&(t.splice(r,1),a.setState({invitedPlayers:t}))},a.sendInvite=function(e){var t=a.state.isPlayer,r=a.props,n=r.isSpectator,s=r.reciever,o=r.user,i=r.changeSpectatingStatus,c=r.setRecievers,l=a.state.selectedPlayers,u=a.state.invitedPlayers,h=l.indexOf(e.target.value),d=u.indexOf(e.target.value);t||(n&&(S.emitReset(s,o,!1),i(!1),c([]),a.setInitBtn(!0)),-1==h&&-1==d&&(l.push(e.target.value),e.target.innerHTML="Invited",e.target.disabled=!0,e.target.style.backgroundColor="green",a.setState({isGameMaster:!0,gameMaster:o}),S.emitGameRequest(o,e.target.value)))},a.setInitBtn=function(e){a.setState({showInitBtn:e})},a.displayUsers=function(e){var t,r=a.props.user;t=Object(b.values)(e).map(function(e){if(e.name!=r&&!e.inGame&&1==e.gameMode){var t=e.name.length>=12?"sideBtnSmall":"sideBtn";return n.a.createElement("div",{key:e.name,className:t},e.name,n.a.createElement("button",{value:e.name,onClick:a.sendInvite},"Invite"))}}),a.setState({users:t})},a.updateAvailableGames=function(e){var t=Object(b.values)(e).map(function(e){var t=e.sender.length>=12?"sideBtnSmall":"sideBtn";return n.a.createElement("div",{className:t},e.sender,"'s game",n.a.createElement("button",{value:e.sender,onClick:a.spectate},"Watch"))});a.setState({games:t})},a.startGame=function(e){var t=a.props,r=t.user,n=t.reciever;a.setState({showReq:!1}),setTimeout(function(){return S.emitGameStart(n,r)},1500)},a.reset=function(){var e=a.props.reciever;a.state.gameMaster&&e.push(a.state.gameMaster),S.emitReset(e,a.props.user,!0),a.props.reset(),a.setState({users:[],reqSent:!1,sender:"",showReq:!0,showSide:!0,selectedPlayers:[],showInitBtn:!0,showStartBtn:!0,invitedPlayers:[],accepted:[],isGameMaster:!1,isPlayer:!1,gameMaster:""})},a.spectate=function(e){S.emitSpectate(a.props.user,e.target.value),a.props.changeSpectatingStatus(!0),a.setInitBtn(!1)},a.render=function(){var e=a.props,t=e.user,r=e.isPlayerReady,s=e.running,o=e.reciever,i=e.initGame,c=e.denied,l=e.isSpectator,u=a.state,h=u.sender,d=u.reqSent,m=u.showReq,v=u.showSide,f=u.games,p=u.showInitBtn,S=u.showStartBtn,k=u.invitedPlayers,E=u.selectedPlayers,y=u.isGameMaster,b=u.isPlayer,A=u.gameMaster,R="",x=null;return f&&!s&&(x=f),o.forEach(function(e){R+=""==R?e:", "+e}),n.a.createElement("div",{className:"setupWrapper"},v&&!l?n.a.createElement("div",{className:"sideTab"},n.a.createElement("p",null,"Available players:"),a.state.users):null,v&&l?n.a.createElement("div",{className:"sideTab"},n.a.createElement("p",null,"Games:"),x):null,p?n.a.createElement("div",null,n.a.createElement(w,{user:t,initializeGame:i,selectedPlayers:E,recievers:o,denied:c,showInitBtn:p&&y&&!b,invitedPlayers:k,isPlayer:b,gameMaster:A})):null,d&&m?n.a.createElement(g,{name:h,accept:a.accept}):null,r&&S&&y?n.a.createElement("div",{className:"buttonsBlock"},n.a.createElement("button",{className:"startBtn",onClick:a.startGame},"Start"),n.a.createElement("br",null)):null)},a.state={users:[],reqSent:!1,sender:"",showReq:!0,showSide:!0,selectedPlayers:[],games:[],showInitBtn:!0,showStartBtn:!0,invitedPlayers:[],accepted:[],isGameMaster:!1,isPlayer:!1,gameMaster:""},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){S.initUserContainer(this.displayUsers,this.setSender,this.finalizeStart,this.showRequest,this.setSide,this.props.setRecievers,this.props.addSpectator,this.updateAvailableGames,this.setInitBtn,this.updateGameSetupScreen,this.emitGameSetup,this.reset,this.removeInvitedPlayer,this.removeGameMaster),S.emitListUpdate()}},{key:"componentWillUpdate",value:function(){var e=this.props,t=e.reciever,a=e.user,r=e.isPlayerReady;a!=this.state.gameMaster||r||S.emitGameSetup(a,t)}},{key:"componentWillUnmount",value:function(){var e=this.state,t=e.isGameMaster,a=e.gameMaster,r=e.invitedPlayers;t?S.emitReset(r,this.props.user,!1):S.emitReset([a],this.props.user,!1)}}]),t}(n.a.Component),R=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).updateWindowDimensions=function(){var e=a.props,t=e.canvasBack,r=e.canvasFront,n=e.rows,s=e.columns,o=e.blockSize,i=e.running,c=e.isPlayerReady,l=e.fixed;if(!i&&c&&!l){if(t){var u=t.current;u.width=s*o,u.height=n*o,a.createGrid(u.getContext("2d"))}if(r){var h=r.current;h.width=s*o,h.height=n*o}}},a.createGrid=function(e){var t=a.props,r=t.rows,n=t.columns,s=t.blockSize;e.lineWidth=1,e.strokeStyle="#ccc";for(var o=1;o<r;o++)e.beginPath(),e.moveTo(0,o*s),e.lineTo(n*s,o*s),e.stroke();for(var i=1;i<n;i++)e.beginPath(),e.moveTo(i*s,0),e.lineTo(i*s,r*s),e.stroke()},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.canvasBack,a=e.canvasFront,r=e.rows,n=e.columns,s=e.blockSize;if(t){var o=t.current;o.width=n*s,o.height=r*s,this.createGrid(o.getContext("2d"))}if(a){var i=a.current;i.width=n*s,i.height=r*s}this.updateWindowDimensions(),window.addEventListener("resize",this.updateWindowDimensions)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateWindowDimensions)}},{key:"render",value:function(){var e=this.props,t=e.rows,a=e.columns,r=e.blockSize,s=e.canvasFront,o=e.canvasBack,i={height:t*r,width:a*r};return n.a.createElement("div",null,n.a.createElement("div",{className:"canvasBlock"},n.a.createElement("canvas",{className:"FrontCanvas",style:i,ref:s}),n.a.createElement("canvas",{className:"BackCanvas",style:i,ref:o})))}}]),t}(n.a.Component),x=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).updateWindowDimensions=a.updateWindowDimensions.bind(Object(y.a)(Object(y.a)(a))),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.canvasSide,a=e.columns,r=e.blockSize;if(null!=t){var n=t.current;n&&(n.width=a/2*r,n.height=2*r)}this.updateWindowDimensions(),window.addEventListener("resize",this.updateWindowDimensions)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateWindowDimensions)}},{key:"updateWindowDimensions",value:function(){var e=this.props,t=e.canvasSide,a=e.columns,r=e.blockSize,n=e.running,s=e.isPlayerReady;if(!n&&s&&null!=t){var o=t.current;o&&(o.width=a/2*r,o.height=2*r)}}},{key:"render",value:function(){var e=this.props,t=e.canvasSide,a=e.rowScore,r=e.totalScore,s=e.blockSize,o=e.columns,i=e.showSide,c=e.name,l={height:2*s,width:o/2*s};return n.a.createElement("div",{className:"sideBlock"},i?n.a.createElement("canvas",{className:"SideCanvas",style:l,ref:t}):null,n.a.createElement("div",{className:"score"},n.a.createElement("table",{className:"infoTable"},n.a.createElement("tbody",null,n.a.createElement("tr",null,n.a.createElement("td",null,"User:"),n.a.createElement("td",{className:"rightTD"},c)),n.a.createElement("tr",null,n.a.createElement("td",null,"Lines:"),n.a.createElement("td",{className:"rightTD"},a)),n.a.createElement("tr",null,n.a.createElement("td",null,"Score:"),n.a.createElement("td",{className:"rightTD"},r))))))}}]),t}(n.a.Component),M=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).close=function(){a.props.resetPopup()},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.user,a=e.accepted;return n.a.createElement("div",{className:"request"},n.a.createElement("p",null,t,a?" accepted your request":" denied your request"),n.a.createElement("div",null,n.a.createElement("button",{onClick:this.close},"Close")))}}]),t}(n.a.Component);var C=function(e){return n.a.createElement("div",{className:"winnerPopup"},n.a.createElement("button",{onClick:e.close},"Close"),"Winner is: ",e.winner,n.a.createElement("br",null),"Score is: ",e.score)},T=a(37),O=T.createEmptyMatrix,D=T.isRowComplete,P=T.createGrid,B=a(38).generateShapes,N=function(e){function t(e){var a;Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).canvasBack=n.a.createRef(),a.canvasFront=n.a.createRef(),a.componentDidMount=function(){a.state.generatedShapes&&a.autoMove()},a.setGeneratedShapes=function(e){var t=a.props,r=t.columns,n=t.rows,s=t.blockSize;return e.map(function(e){var t=e.color;return new p(e.coords,r,n,s,t)})},a.tempShape=function(e){var t=[];return e.coordiantesArr.forEach(function(e){var a=[];e.forEach(function(e){a.push({y:e.y,x:e.x})}),t.push(a)}),new p(t,e.columns,e.rows,e.size,e.color)},a.numberOfFilledFields=function(e,t){for(var a,r,n=0,s=0;s<e.length-1;s++)a=0,r=0,e[s].forEach(function(e){e.status&&a++}),t[s].forEach(function(e){e.status&&r++}),r>a&&(n+=(r-a)*s);return n},a.clearRow=function(e){var t=a.props.columns,r=a.state.matrix;r.splice(e,1),r.unshift(function(){for(var e=[],a=0;a<t;a++)e.push({status:!1,color:"white"});return e}()),a.setState({matrix:r})},a.autoMove=function(){var e=a.state,t=e.index,r=e.matrix,n=e.speed,s=a.state.generatedShapes,o=a.props,i=o.columns,c=o.rows,l=o.blockSize;if(void 0==s[t]){var u=a.setGeneratedShapes(B(1e3,7));s=s.concat(u),a.setState({generatedShapes:s})}var h=s[t],d=a.findBestPosition(h),m=0,v=a.canvasFront.current,f=a.canvasBack.current;if(v&&f)var p=v.getContext("2d"),S=f.getContext("2d"),k=setInterval(function(){if(a.setState({intervalId:k}),m<d.rotation)h.rotate(),m++,p&&p.clearRect(0,0,2e3,2e3),h&&h.updateCanvas(p);else if(d.bestShape.blocksArr)if(h.blocksArr[0].left>d.bestShape.blocksArr[0].left)h.areBlocksFreeToMoveLeft(r)&&(h.moveLeft(),p&&p.clearRect(0,0,2e3,2e3),h.updateCanvas(p));else if(h&&h.blocksArr[0].left<d.bestShape.blocksArr[0].left)h.areBlocksFreeToMoveRight(r)&&(h.moveRight(),p&&p.clearRect(0,0,2e3,2e3),h.updateCanvas(p));else if(h&&h.areBlocksFreeToMoveDown(r))p&&p.clearRect(0,0,2e3,2e3),h.updateCanvas(p),h.moveDown();else{h.moveBack(),h.updateCanvas(p);var e=a.addShapeToMatrix(d.bestShape,r);a.setState({matrix:e,index:t+1}),D(i,c,r).length>0&&D(i,c,r).forEach(function(e){a.clearRow(e),S&&S.clearRect(0,0,2e3,2e3),P(S,i,c,l),a.fillCanvas(S)}),S&&S.clearRect(0,0,2e3,2e3),P(S,i,c,l),a.fillCanvas(S),clearInterval(k),a.autoMove()}},n)},a.fillCanvas=function(e){for(var t=a.state.matrix,r=a.props,n=r.columns,s=r.rows,o=r.blockSize,i=new f(0,o,"red",o),c=0;c<s;c++)for(var l=0;l<n;l++)t[c][l].status&&i.draw(l*o,c*o,e,t[c][l].color)},a.copyBlocks=function(e){for(var t=!1,a=!1,r=0;r<4;r++)e[r].top<0&&(t=!0),e[r].left<0&&(a=!0);return e.map(function(e){return t||a?new f(0,0,e.color,e.size):new f(e.left,e.top,e.color,e.size)})},a.findBestPosition=function(e){var t,r=a.props,n=r.rows,s=r.columns,o=r.blockSize,i=a.state.matrix,c=s,l=0,u=[],h=a.copyMatrix(i),d=0,m=0,v=0,f=0;if(e)for(var p=0;p<e.coordiantesArr.length;p++)for(var S=a.tempShape(e),k=0;k<s;k++)if((S=a.tempShape(e)).setBlocks(e.fillArr(e.coordiantesArr[p],o,s)),S.areBlocksFreeToMoveRight(i)){for(;S.areBlockOutOfBoundsLeft();)S.moveLeft();for(var E=0;E<k;E++)S.moveRight();for(d=0;S.areBlocksFreeToMoveDown(i);)S.moveDown(),d++;if(c=S.areBlocksFreeToMoveDownNumber(i),S.moveBack(),h=a.addShapeToMatrix(S,h),f=a.numberOfFilledFields(i,h),t=D(s,n,h).length,a.isShapeAVerticalLine(S)&&(c=4,l=4),t>0&&4==c)return l=c,t,{bestShape:u=S,rotation:m=p};v<=f&&4==c?(l=c,v=f,d,m=p,u=S):l<=c&&4!=l?(l=c,v=f,d,m=p,u=S):u||(u=S),h=a.removeShapeFromMatrix(S,h)}return{bestShape:u,rotation:m}},a.getMatrixHeight=function(e,t,a){for(var r=0;r<t;r++)for(var n=0;n<e;n++)if(a[r][n].status)return t-r;return 0},a.getColumnHeight=function(e,t,a){for(var r=0;r<t;r++)if(a[r][e].status)return t-r;return 0},a.isShapeAVerticalLine=function(e){return e.blocksArr[0].left==e.blocksArr[3].left&&e.blocksArr[0].left==e.blocksArr[1].left&&e.blocksArr[0].left==e.blocksArr[2].left},a.doesShapeNeedOneBlock=function(e){return e.blocksArr[0].left==e.blocksArr[3].left&&e.blocksArr[0].left==e.blocksArr[1].left},a.copyMatrix=function(e){return e.map(function(e){return e.map(function(e){return{status:e.status,color:e.color}})})},a.addShapeToMatrix=function(e,t){return e&&e.blocksArr.forEach(function(a){a&&t&&t[Math.round(a.top/e.size)]&&t[Math.round(a.top/e.size)][Math.round(a.left/e.size)]&&(t[Math.round(a.top/e.size)][Math.round(a.left/e.size)].status=!0,t[Math.round(a.top/e.size)][Math.round(a.left/e.size)].color=a.color)}),t},a.removeShapeFromMatrix=function(e,t){return e&&e.blocksArr.forEach(function(a){a&&t&&t[Math.round(a.top/e.size)]&&t[Math.round(a.top/e.size)][Math.round(a.left/e.size)]&&(t[Math.round(a.top/e.size)][Math.round(a.left/e.size)].status=!1,t[Math.round(a.top/e.size)][Math.round(a.left/e.size)].color="white")}),t},a.changeSpeed=function(e){var t=a.state.speed;(t+=1*e.target.value)>=10&&a.setState({speed:t})};var r=a.setGeneratedShapes(B(1e3,7)),s=O(e.columns,e.rows);return a.state={index:0,moveCounter:0,matrix:s,generatedShapes:r,speed:50,intervalId:null},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentWillUnmount",value:function(){clearInterval(this.state.intervalId)}},{key:"render",value:function(){var e=this.props,t=e.rows,a=e.columns,r=e.blockSize;return n.a.createElement("div",{className:"transparent"},n.a.createElement(R,{rows:t,columns:a,blockSize:r,canvasBack:this.canvasBack,canvasFront:this.canvasFront,fixed:!0}),n.a.createElement("button",{onClick:this.changeSpeed,value:-10},"Faster"),n.a.createElement("button",{onClick:this.changeSpeed,value:10},"Slower"))}}]),t}(n.a.Component),G=a(38).generateShapes,I=a(37),z=I.createEmptyMatrix,U=I.isRowComplete,j=I.createGrid,_=function(e){function t(e){var a;Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).canvasBack=n.a.createRef(),a.canvasFront=n.a.createRef(),a.canvasSide=n.a.createRef(),a.canvasBack2=n.a.createRef(),a.canvasBack3=n.a.createRef(),a.canvasBack4=n.a.createRef(),a.initSocket=function(){var e=a.state,t=e.columns,r=e.rows,n=e.blockSize,s=S.generateShapes(t,r,n);a.setState({generatedShapes:s,nextShape:s[0]}),S.initMainTetrisContext(a.setGeneratedShapes,a.setReciever,a.addShapes,a.showAccepted,a.setRecievers,a.removeSpectator,a.opponentGameOver,a.removeReciever,a.setShapesCoords,a.setPlayerReady,a.setDifficulty,a.displayWinner),S.updateGame(a.updateSecondCanvas),S.spectatingGames(a.updateSpectatingCanvas)},a.displayWinner=function(e){a.setState({winner:n.a.createElement(C,{winner:e.winner,score:e.score,close:a.hideWinner})})},a.hideWinner=function(){a.setState({winner:null})},a.setShapesCoords=function(e){a.setState({shapesCoords:e})},a.setDifficulty=function(e){a.setState({difficulty:e})},a.setRecievers=function(e){a.setState({recievers:e})},a.removeReciever=function(e){var t=a.state.recievers,r=a.state.running,n=t.indexOf(e);-1==n||r||(t.splice(n,1),a.setState({recievers:t}))},a.opponentGameOver=function(e){var t=a.state.recievers.indexOf(e);if(-1!=t){var r=a.getCanvasBasedOnRecieverIndex(t);a.gameOver(r)}},a.addShapes=function(e){var t,r=a.state.generatedShapes,n=a.state,s=n.columns,o=n.rows,i=n.blockSize,c=e.map(function(e){var t=e.color;return new p(e.coords,s,o,i,t)});t=r.concat(c),a.setState({generatedShapes:t})},a.addSpectator=function(e){var t=a.state.spectators;-1==t.indexOf(e)&&(t.push(e),a.setState({spectators:t}))},a.removeSpectator=function(e){var t=a.state.spectators,r=t.indexOf(e);-1!=r&&t.splice(r,1),a.setState({spectators:t})},a.showAccepted=function(e,t){if(a.setState({reqAccepted:n.a.createElement(M,{user:e,accepted:t,resetPopup:a.resetPopup})}),!t){var r=a.state.denied;r.push(e),a.setState({denied:r})}setTimeout(a.resetPopup,5e3)},a.resetPopup=function(){a.setState({reqAccepted:null})},a.setGeneratedShapes=function(e){var t,r=a.state,n=r.columns,s=r.rows,o=r.blockSize;return t=e.map(function(e){var t=e.color;return new p(e.coords,n,s,o,t)}),a.setState({generatedShapes:t,nextShape:t[0]}),t},a.changeSpectatingStatus=function(e){a.setState({isSpectator:e})},a.setUser=function(e){S.emitUserConnected(e),a.setState({user:e})},a.logout=function(e){e.preventDefault(),S.emitLogout(),a.setState({currentShape:a.defaultShape(),allBlocks:[],running:!1,score:0,speed:900,counterId:-1,delay:1,baseDelay:20,totalScore:0,acceleration:0,columns:10,rows:20,blockSize:40,user:null,recievers:[],scorePlayer2:0,totalScorePlayer2:0,generatedShapes:null,generatedShapesIndex:0,isPlayerReady:!1,matrix:z(10,20),nextShape:a.defaultShape()})},a.updateSecondCanvas=function(e){var t,r=a.state,n=r.columns,s=r.blockSize,o=r.rows,i=r.recievers,c=a.state.acceleration,l=i.indexOf(e.sender);e.acceleration>c&&a.setState({acceleration:e.acceleration});var u=new f(0,0,"red",s/2);switch(l){case 0:t=a.canvasBack2.current,a.setState({totalScorePlayer2:e.totalScore,scorePlayer2:e.score});break;case 1:t=a.canvasBack3.current,a.setState({totalScorePlayer3:e.totalScore,scorePlayer3:e.score});break;case 2:t=a.canvasBack4.current,a.setState({totalScorePlayer4:e.totalScore,scorePlayer4:e.score})}if(t){var h=t.getContext("2d");h.clearRect(0,0,n*s/2,o*s/2);var d=new p(e.shape.coordiantesArr,n,o,s/2,"red");d.defineNewProperties(e.shape.blocksArr,2,s/e.blockSize),j(h,n,o,s,.5),d.updateCanvas(h);for(var m=0;m<o;m++)for(var v=0;v<n;v++)e.matrix[m][v].status&&u.draw(v*s/2,m*s/2,h,"red")}},a.getCanvasBasedOnRecieverIndex=function(e){var t=a.canvasBack.current;switch(e){case 0:t=a.canvasBack2.current;break;case 1:t=a.canvasBack3.current;break;case 2:t=a.canvasBack4.current;break;case 3:t=a.canvasBack.current}return t},a.setScoreBasedOnRecieverIndex=function(e,t){switch(e){case 0:a.setState({totalScorePlayer2:t.totalScore,scorePlayer2:t.score});break;case 1:a.setState({totalScorePlayer3:t.totalScore,scorePlayer3:t.score});break;case 2:a.setState({totalScorePlayer4:t.totalScore,scorePlayer4:t.score});break;case 3:a.setState({totalScore:t.totalScore,score:t.score})}},a.updateSpectatingCanvas=function(e){var t=a.state,r=t.recievers,n=t.columns,s=t.blockSize,o=t.rows,i=a.canvasBack.current,c=r.indexOf(e.user),l=new f(0,0,"red",s/2);if(i=a.getCanvasBasedOnRecieverIndex(c),a.setScoreBasedOnRecieverIndex(c,e),i){var u=i.getContext("2d");u.clearRect(0,0,n*s/2,o*s/2);var h=new p(e.shape.coordiantesArr,n,o,s/2,"red");h.defineNewProperties(e.shape.blocksArr,2,s/e.blockSize),j(u,n,o,s,.5),h.updateCanvas(u);for(var d=0;d<o;d++)for(var m=0;m<n;m++)e.matrix[d][m].status&&l.draw(m*s/2,d*s/2,u,"red")}},a.defaultShape=function(){return new p([[{x:0,y:0}]],10,20,40,"red")},a.startGame=function(){if(!a.state.running){var e=a.state,t=e.user;2==e.gameMode&&S.emitUserInGame(t.name);var r=a.state.columns,n=a.state.rows,s=a.state.blockSize;a.run();var o=a.canvasBack.current;if(o){var i=o.getContext("2d");i.clearRect(0,0,r*s,n*s),a.setState({matrix:z(r,n),score:0,totalScore:0}),j(i,r,n,s)}}},a.run=function(){a.setState({running:!0});var e=a.state.columns,t=a.state.rows,r=a.state.blockSize,n=a.state.matrix,s=a.state,o=s.generatedShapes,i=s.nextShape,c=s.recievers,l=s.user,u=s.gameMode,h=s.score,d=(s.totalScore,s.difficulty),m=a.state.generatedShapesIndex,v=a.state.acceleration;o&&m+10==o.length&&2==u&&S.emitAddShapes(c),a.setState({baseDelay:20-v});var f=a.canvasFront.current;if(f){var p=f.getContext("2d");m+=1,a.setState({generatedShapesIndex:m});var k=o[m],E=a.deepCopyShape(i);p.clearRect(0,0,e*r,t*r);var y=a.canvasSide.current.getContext("2d");if(y.clearRect(0,0,e*r,t*r),null!=i&&i.updateCanvas(p),y){var b=a.deepCopyShape(k);b.fitToSide(2.5),b.updateCanvas(y),b.fitToSide(-2.5)}if(a.setState({currentShape:E,nextShape:k}),U(e,t,n).length>0&&U(e,t,n).forEach(function(e){a.clearRow(e)}),a.isGameOver(k,n)){var g=a.state.totalScore-10;a.setState({running:!1,totalScore:g}),a.gameOver(f),S.emitGameOver(l.name,c,h,g,d)}else{var w=setInterval(function(){return a.moveShape(E,w)},50);a.setState({counterId:w})}}},a.gameOver=function(e){if(e){var t=e.getContext("2d"),a=e.width/10+"px";t.font="bold "+a+" Verdana",t.textAlign="center",t.fillText("GAME OVER",e.width/2,e.height/2),t.strokeStyle="black",t.strokeText("GAME OVER",e.width/2,e.height/2)}},a.moveShape=function(e,t){var r=a.state.delay,n=a.state,s=n.user,o=n.columns,i=n.rows,c=n.blockSize,l=n.totalScore,u=n.score,h=n.recievers,d=n.acceleration,m=n.spectators,v=n.gameMode,f=a.state.matrix;if(s&&e&&2==v&&S.emitGameUpdate(f,e,h,s.name,l,u,d,c),m&&m.forEach(function(t){S.emitSpectatorData(f,e,t,s.name,l,u,c)}),r<=a.state.baseDelay)r++,a.setState({delay:r});else{a.setState({delay:1,baseDelay:20-d});var p=a.canvasFront.current;if(p){var k=p.getContext("2d");k.clearRect(0,0,o*c,i*c),e.moveDown(),e.areBlocksFreeToMoveDown(f)&&e.updateCanvas(k)}e.areBlocksFreeToMoveDown(f)||(a.state.currentShape.moveBack(),a.state.currentShape.blocksArr.forEach(function(e){f[Math.round(e.top/c)][Math.round(e.left/c)].status=!0,f[Math.round(e.top/c)][Math.round(e.left/c)].color=e.color}),a.setState({matrix:f}),a.updateStateOfTheGame(e),clearInterval(t),a.run())}},a.stopGame=function(){clearInterval(a.state.counterId)},a.updateStateOfTheGame=function(e){var t=a.state.columns,r=a.state.rows,n=a.state.blockSize,s=a.state.matrix,o=a.canvasBack.current,i=a.state.totalScore,c=o.getContext("2d"),l=U(t,r,s);if(l.length>0){switch(l.length){case 1:i+=100;break;case 2:i+=250;break;case 3:i+=450;break;case 4:i+=800}l.forEach(function(e){a.clearRow(e)}),c.clearRect(0,0,t*n,r*n),j(c,t,r,n)}for(var u=new f(0,0,"blue",n),h=0;h<r;h++)for(var d=0;d<t;d++)s[h][d].status&&u.draw(d*n,h*n,c,s[h][d].color);i+=10;var m=a.state.allBlocks;e.moveBack(),m.push(a.state.currentShape),a.setState({totalScore:i});var v=a.state.acceleration;a.state.totalScore>400*(v+1)&&++v<20&&a.setState({acceleration:v})},a.isGameOver=function(e,t){return!e.areBlocksFreeToMoveDown(t)},a.clearRow=function(e){var t=a.state.columns,r=a.state.matrix;r.splice(e,1),r.unshift(function(){for(var e=[],a=0;a<t;a++)e.push({status:!1,color:"white"});return e}());var n=a.state.score;n+=1,a.setState({matrix:r,score:n})},a.handleMove=function(e){var t=a.state.columns,r=a.state.rows,n=a.state.blockSize;if(a.state.running){var s=e.target.id,o=a.canvasFront.current.getContext("2d"),i=a.state.currentShape,c=a.state.matrix;"right"==s&&i.areBlocksFreeToMoveRight(c)?i.moveRight():"left"==s&&i.areBlocksFreeToMoveLeft(c)&&i.moveLeft(),o.clearRect(0,0,n*t,n*r),i.updateCanvas(o)}},a.handleRotate=function(){var e=a.state.columns,t=a.state.rows,r=a.state.blockSize;if(a.state.running){var n=a.deepCopyShape(a.state.currentShape),s=a.state.currentShape;if(n.rotate(),n.areBlockOutOfRotateBoundsLeft()&&n.areBlockOutOfRotateBoundsRight())if(n.areBlocksFreeToRotate(a.state.matrix)){var o=a.canvasFront.current.getContext("2d");o.clearRect(0,0,r*e,r*t),n.updateCanvas(o)}else n.rotate(),n.rotate(),n.rotate(),a.setState({currentShape:s});else n.rotate(),n.rotate(),n.rotate(),a.setState({currentShape:s});a.setState({currentShape:n})}},a.setReciever=function(e){var t=a.state.recievers;t.length<3&&t.push(e),a.setState({recievers:t})},a.reset=function(){clearInterval(a.state.counterId),a.setState({currentShape:a.defaultShape(),nextShape:a.defaultShape(),allBlocks:[],running:!1,matrix:z(10,20),score:0,speed:900,counterId:-1,delay:1,baseDelay:20,totalScore:0,acceleration:0,columns:10,rows:20,blockSize:40,recievers:[],scorePlayer2:0,totalScorePlayer2:0,scorePlayer3:0,totalScorePlayer3:0,scorePlayer4:0,totalScorePlayer4:0,generatedShapes:null,generatedShapesIndex:0,isPlayerReady:!1,spectators:[],isSpectator:!1,specCanvases:null,reqAccepted:null,denied:[],difficulty:7,windowHeight:window.innerHeight,windowWidth:window.innerWidth})},a.generateSpecCanvases=function(){for(var e=a.state,t=e.rows,r=e.columns,s=e.blockSize,o=e.recievers,i=(e.running,e.isPlayerReady,[]),c=0;c<o.length;c++){var l=a.generateCanvasData(c);if(l){var u=o[c]?n.a.createElement("div",{key:"canvas"+c,className:l.className},n.a.createElement(R,{rows:t,columns:r,blockSize:s/2,canvasFront:null,canvasBack:l.canvasBack,running:!1,isPlayerReady:!0}),n.a.createElement(x,{canvasSide:null,showSide:!1,rowScore:l.rowScore,totalScore:l.totalScore,columns:r,blockSize:s,name:o[c]})):null;i.push(u)}}return i},a.generateCanvasData=function(e){var t=a.state,r=t.score,n=t.scorePlayer2,s=t.scorePlayer3,o=t.scorePlayer4,i=t.totalScore,c=t.totalScorePlayer2,l=t.totalScorePlayer3,u=t.totalScorePlayer4,h=null;switch(e){case 0:h={className:"canvas1",rowScore:n,totalScore:c,canvasBack:a.canvasBack2};break;case 1:h={className:"canvas2",rowScore:s,totalScore:l,canvasBack:a.canvasBack3};break;case 2:h={className:"canvas3",rowScore:o,totalScore:u,canvasBack:a.canvasBack4};break;case 3:h={className:"canvas4",rowScore:r,totalScore:i,canvasBack:a.canvasBack}}return h},a.initGame=function(){var e=a.state,t=e.user,r=e.recievers,n=e.difficulty;S.emitInitializeGame(t.name,r,n),a.setPlayerReady(!0)},a.setPlayerReady=function(e){a.setState({isPlayerReady:e})},a.singlePlayer=function(){var e=G(1e3,a.state.difficulty),t=a.setGeneratedShapes(e);a.setState({shapesCoords:e,generatedShapes:t,nextShape:t[0],gameMode:1,isPlayerReady:!0}),S.emitInitializeGame(a.state.user.name,[],a.state.difficulty)};var r=3==e.mode;return a.state={currentShape:a.defaultShape(),nextShape:a.defaultShape(),allBlocks:[],running:!1,matrix:[],score:0,speed:900,counterId:-1,delay:1,baseDelay:20,totalScore:0,acceleration:0,columns:10,rows:20,blockSize:40,user:e.user,recievers:[],scorePlayer2:0,totalScorePlayer2:0,scorePlayer3:0,totalScorePlayer3:0,scorePlayer4:0,totalScorePlayer4:0,generatedShapes:null,generatedShapesIndex:0,isPlayerReady:!1,spectators:[],isSpectator:r,specCanvases:null,reqAccepted:null,denied:[],difficulty:e.difficulty,gameMode:e.mode,windowHeight:window.innerHeight,windowWidth:window.innerWidth,shapesCoords:[],winner:null},a.updateWindowDimensions=a.updateWindowDimensions.bind(Object(y.a)(Object(y.a)(a))),a.onKeyUp=a.onKeyUp.bind(Object(y.a)(Object(y.a)(a))),a.handleKeyDown=a.handleKeyDown.bind(Object(y.a)(Object(y.a)(a))),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.setState({matrix:z(10,20)}),window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.onKeyUp),this.initSocket(),this.updateWindowDimensions(),window.addEventListener("resize",this.updateWindowDimensions),1==this.state.gameMode&&this.singlePlayer()}},{key:"componentWillUnmount",value:function(){clearInterval(this.state.counterId),S.emitReset(this.state.recievers,this.state.user.name,!1),window.removeEventListener("resize",this.updateWindowDimensions),window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.onKeyUp)}},{key:"updateWindowDimensions",value:function(){var e=window.innerWidth,t=window.innerHeight;if(this.setState({windowWidth:e,windowHeight:t}),!this.state.running){var a=40;if(t>=900&&(a=40),t<900&&(a=35),t<800&&(a=30),t<700&&(a=25),this.setState({blockSize:a}),this.state.user){var r=this.setGeneratedShapes(this.state.shapesCoords);this.setState({generatedShapes:r})}}}},{key:"deepCopyShape",value:function(e){var t=e;if(null==e||"object"!=typeof e)return e;if(e instanceof Object){for(var a in e)e.hasOwnProperty(a)&&(t[a]=this.deepCopyShape(e[a]));return t}}},{key:"handleKeyDown",value:function(e){if(e.preventDefault(),this.state.running){var t=this.canvasFront.current.getContext("2d"),a=this.state.currentShape,r=this.state.matrix,n=this.state.columns,s=this.state.rows,o=this.state.blockSize,i=this.state.acceleration,c=this.state.totalScore,l=22-i;if(39==e.keyCode&&a.areBlocksFreeToMoveRight(r)?(a.moveRight(),this.setState({baseDelay:l})):37==e.keyCode&&a.areBlocksFreeToMoveLeft(r)&&(a.moveLeft(),this.setState({baseDelay:l})),t.clearRect(0,0,n*o,s*o),a.updateCanvas(t),38==e.keyCode&&(this.handleRotate(),this.setState({baseDelay:l})),40==e.keyCode&&this.setState({baseDelay:1}),32==e.keyCode){for(var u=0;a.areBlocksFreeToMoveDown(r);)a.moveDown(),u+=1;a.areBlocksFreeToMoveDown(r)||(this.state.currentShape.moveBack(),this.state.currentShape.blocksArr.forEach(function(e){e&&(r[Math.round(e.top/o)][Math.round(e.left/o)].status=!0,r[Math.round(e.top/o)][Math.round(e.left/o)].color=e.color)}),this.setState({matrix:r,totalScore:c+u}),this.updateStateOfTheGame(a),clearInterval(this.state.counterId),this.run())}}}},{key:"onKeyUp",value:function(e){if(e.preventDefault(),40==e.keyCode){var t=this.state.acceleration;this.setState({baseDelay:20-t})}}},{key:"render",value:function(){var e=this.state,t=e.isSpectator,a=e.columns,r=e.rows,s=e.blockSize,o=e.score,i=e.totalScore,c=e.user,l=e.recievers,u=e.isPlayerReady,h=e.running,d=e.reqAccepted,m=e.denied,v=e.gameMode,f=e.winner,p=this.generateSpecCanvases();return n.a.createElement("div",{onKeyUp:this.onKeyUp,className:"mainWrapper"},n.a.createElement("div",null,2==v||3==v?n.a.createElement("div",null,n.a.createElement(A,{setGeneratedShapes:this.setGeneratedShapes,reciever:l,startGame:this.startGame,user:c.name,logout:this.logout,setRecievers:this.setRecievers,isPlayerReady:u,changeSpectatingStatus:this.changeSpectatingStatus,running:h,reset:this.reset,addSpectator:this.addSpectator,initGame:this.initGame,denied:m,isSpectator:t}),u||t?null:n.a.createElement("div",{className:"transparentCanvasBackground"},n.a.createElement(N,{rows:20,columns:25,blockSize:40}))):null,u?n.a.createElement("div",{className:"main"},n.a.createElement("div",{className:"mainCanvasWrapper"},n.a.createElement("div",{className:"wrap"},n.a.createElement(R,{rows:r,columns:a,blockSize:s,canvasFront:this.canvasFront,canvasBack:this.canvasBack,running:h,isPlayerReady:u})),n.a.createElement("div",{className:"sideWrap"},n.a.createElement(x,{canvasSide:this.canvasSide,showSide:!0,rowScore:o,totalScore:i,columns:a,blockSize:s,name:c.name,running:h,isPlayerReady:u}),1==v?n.a.createElement("div",null,n.a.createElement("button",{className:"startBtn",onClick:this.startGame},"Start")):null)),p,f):null,t?n.a.createElement("div",{className:"main"},n.a.createElement("br",null),p):null),d)}}]),t}(n.a.Component);var L=function(e){for(var t=[],a=0;a<10;a++)e.scores[a]&&t.push(n.a.createElement("tr",null,n.a.createElement("td",null,a+1,"."),n.a.createElement("td",null,e.scores[a].name),n.a.createElement("td",null,e.scores[a].score),n.a.createElement("td",null,e.scores[a].rows)));return n.a.createElement("div",{className:"highscore"},"Highscores - ",e.title,n.a.createElement("table",null,n.a.createElement("tbody",null,n.a.createElement("tr",null,n.a.createElement("td",null," "),n.a.createElement("td",null,"Name"),n.a.createElement("td",null,"Score"),n.a.createElement("td",null,"Lines")),t)),"-----------")};var F=function(e){var t;switch(e.gameMode){case 1:t="- Game mode: Singleplayer";break;case 2:t="- Game mode: Multiplayer";break;case 3:t="- Game mode: Spectating";break;default:t=null}return n.a.createElement("div",{className:"userInfo"},n.a.createElement("div",{className:"usernameDisplay"},"User: ",e.user," ",t),n.a.createElement("div",{className:"buttonDisplay"},n.a.createElement("button",{className:"resetBtn",onClick:e.setDisplay,value:0},"Menu"),n.a.createElement("button",{onClick:e.logout},"Logout")))},W=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).componentDidMount=function(){a.setState({width:window.innerWidth}),S.initMenu(a.setHighscore)},a.setDisplay=function(e){var t=1*e.target.value;2!=t&&3!=t||S.emitMultiplayer(a.props.user.name),a.setState({display:1*e.target.value})},a.setHighscore=function(e){"normal"==e.mode?a.setState({highscore:e.result}):a.setState({highscoreEasy:e.result})},a.setDifficulty=function(e){a.setState({difficulty:1*e.target.value,display:0})},a.logout=function(){S.emitLogout(),a.props.logout()},a.state={display:0,difficulty:7,highscore:[],highscoreEasy:[],width:window.innerWidth},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.state,t=e.display,a=e.difficulty,r=e.highscore,s=e.highscoreEasy,o=e.width,i=this.props.user,c=n.a.createElement("div",null);switch(t){case 0:c=n.a.createElement("div",{className:"leftMenu"},n.a.createElement("p",{className:"title2"},"TETRIS"),n.a.createElement("div",{className:"menuButtons"},n.a.createElement("p",null,"Menu"),n.a.createElement("button",{onClick:this.setDisplay,value:1},"SINGLEPLAYER"),n.a.createElement("button",{onClick:this.setDisplay,value:2},"MULTIPLAYER"),n.a.createElement("button",{onClick:this.setDisplay,value:3},"SPECTATE"),n.a.createElement("button",{onClick:this.setDisplay,value:4},"SETTINGS"),n.a.createElement("button",{onClick:this.setDisplay,value:5},"HIGHSCORES")));break;case 1:c=n.a.createElement(_,{setDisplay:this.setDisplay,difficulty:a,user:i,mode:t});break;case 2:case 3:c=n.a.createElement(_,{setDisplay:null,difficulty:a,user:i,mode:t});break;case 4:c=n.a.createElement("div",{className:"leftMenu"},n.a.createElement("p",{className:"title2"},"TETRIS"),n.a.createElement("div",{className:"menuButtons"},n.a.createElement("p",null,"Select difficulty"),n.a.createElement("button",{onClick:this.setDifficulty,value:7},"NORMAL"),n.a.createElement("button",{onClick:this.setDifficulty,value:10},"EASY"),n.a.createElement("button",{onClick:this.setDisplay,value:0},"Back")));break;case 5:c=n.a.createElement("div",{className:"leftMenu"},n.a.createElement("div",{className:"highscoreWrapper"},r!=[]?n.a.createElement(L,{scores:r,title:"Normal"}):null,s!=[]?n.a.createElement(L,{scores:s,title:"Easy"}):null,n.a.createElement("button",{onClick:this.setDisplay,value:0},"Back")))}return n.a.createElement("div",{className:"mainWrapper"},n.a.createElement(F,{user:i.name,logout:this.logout,setDisplay:this.setDisplay,gameMode:t}),n.a.createElement("div",{className:"menuWrapper"},c,0==t||4==t||5==t?n.a.createElement(N,{rows:20,columns:20,blockSize:Math.round(o/2/22)}):null))}}]),t}(n.a.Component),q=a(22),H=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).title=n.a.createRef(),a.t=document.getElementsByClassName("title"),a.animate=function(){(new q.b).fromTo(a.t,1,{width:"0",left:"50%"},{width:"100%",left:"0%"}).fromTo(a.t,1,{color:"rgba(255, 255, 255, 0)"},{color:"#595959",ease:q.a.easeInOut},"-=0.5")},a.setDisplay=function(e){a.setState({display:e})},a.handleClick=function(e){a.setState({display:e.target.value})},a.setUser=function(e){S.emitUserConnected(e),a.setState({user:e,display:4})},a.logout=function(){a.setState({display:0,user:null})},a.state={display:0,user:null},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.animate()}},{key:"componentDidUpdate",value:function(){0==this.state.display&&this.animate()}},{key:"render",value:function(){var e=this.state,t=e.display,a=e.user;return n.a.createElement("div",{className:"main-container"},a?n.a.createElement("div",null,n.a.createElement(W,{user:a,logout:this.logout})," "):n.a.createElement("div",null,0==t?n.a.createElement("div",null,n.a.createElement("nav",null,n.a.createElement("div",{className:"register"},n.a.createElement("button",{onClick:this.handleClick,value:1},"Login"),n.a.createElement("button",{onClick:this.handleClick,value:2},"Register"))),n.a.createElement("div",{className:"title",id:"title",ref:this.title},"TETRIS")):null,1==t?n.a.createElement("div",null,n.a.createElement(E,{setUser:this.setUser,setDisplay:this.handleClick})," "):null,2==t?n.a.createElement("div",null,n.a.createElement(k,{setDisplay:this.handleClick})," "):null,3==t?n.a.createElement("div",{className:"register"},"Register Successful!",n.a.createElement("button",{onClick:this.handleClick,value:1},"Login")):null))}}]),t}(r.Component),Y=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return n.a.createElement("div",{className:"App"},n.a.createElement(H,null))}}]),t}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(n.a.createElement(Y,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[41,1,2]]]);
//# sourceMappingURL=main.cfa7481e.chunk.js.map